(function($){"use strict";var validationParams={username:/^[a-zA-Z]{1}([a-zA-Z0-9]){4,19}$/,mobile:/^(((13[0-9]{1})|(15[0-9]{1})|(18[0-9]{1})|(17[0-9]{1})|(14[0-9]{1}))+\d{8})$/,email:/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+((.[a-zA-Z0-9_-]{2,3}){1,2})$/,password:/^(\w){6,20}$/,number:/^[1-9]*[1-9][0-9]*$/,license:/^[京津沪渝冀豫云辽黑湘皖鲁新苏浙赣鄂桂甘晋蒙陕吉闽贵粤青藏川宁琼使领A-Z]{1}[A-Z]{1}[A-Z0-9]{4}[A-Z0-9挂学警港澳]{1}$/,phone:/^(0[0-9]{2,3}\-)?([2-9][0-9]{6,7})+(\-[0-9]{1,4})?$/};$.fn.validation=function(options,methods){var defales={successStyle:false,showTip:true,warning:true,tipTimeout:0,callback:$.fun};var _option=$.extend(defales,options);var $this=$(this);var $inputs=$this.find("input[validation]");var success=[];try{$inputs.each(function(i,input){var _this=$(input);success[i]=channle(_this,_option)})}catch(e){alert(e.message);return false}var yes=true;var count=0;$.each(success,function(i,value){if(!value){yes=false;count++}});if(_option.warning&&count>0){var _iconThis=$this.find("#validationWarning");if(_iconThis){closeWarning(_iconThis)}var _html='<div class="alert alert-warning">';_html+='<a href="#" class="close" id="validationWarning">&times;</a>';_html+="<strong>警告！</strong>总共有 "+count+" 处错误。</div>";$this.prepend(_html);_iconThis=$this.find("#validationWarning");bindCloseWarning(_iconThis)}else{var _iconThis=$this.find("#validationWarning");if(_iconThis){closeWarning(_iconThis)}}if(typeof _option.callback==="function"){_option.callback(yes,$this)}return $this};function channle(_inputThis,_option){var _success=true;var _isEmpty=_inputThis.attr("isEmpty")||false;var _inputValue=_inputThis.val();if(_isEmpty==="true"){if(_inputValue){_success=validation(_inputThis,_option)}}else{if(_inputValue){_success=validation(_inputThis,_option)}else{createError(_inputThis,_option);_success=false}}return _success}function validation(_inputThis,_opt){var _type=_inputThis.attr("validation")||"";var _regular=validationParams[_type]||_type;var _reg=new RegExp(_regular);var _success=false;var _val=_inputThis.val();if(_reg.test(_val)){if(_opt.successStyle){createSuccess(_inputThis)}_success=true}else{createError(_inputThis,_opt)}return _success}function createSuccess(t){var _html='<span class="glyphicon glyphicon-ok form-control-feedback"></span>';var _style="has-success has-feedback";var _parentDvis=t.parents("div");_parentDvis.each(function(){var _css=$(this).attr("class");if(_css&&_css.indexOf("form-group")>=0){$(this).addClass(_style)}});t.after(_html)}function createError(t,opt){var _html='<span class="glyphicon glyphicon-remove form-control-feedback"></span>';var _style="has-error has-feedback";var _parentDvis=t.parents("div");_parentDvis.each(function(){var $this=$(this);var _css=$this.attr("class");if(_css&&_css.indexOf("form-group")>=0){$this.addClass(_style)}});t.after(_html);if(opt.showTip){createTip(t,opt)}bindFunction(t,opt)}function removeErrorStyle(_inputThis){var _span=_inputThis.nextAll("span");_span.each(function(){var $this=$(this);var _spanClass=$this.attr("class");if(_spanClass&&_spanClass.indexOf("glyphicon-remove")>=0){$this.remove()}});var _style="has-error has-feedback";var _parentDvis=_inputThis.parents("div");_parentDvis.each(function(){var $this=$(this);var _css=$this.attr("class");if(_css&&_css.indexOf("form-group")>=0){$this.removeClass(_style)}})}function createTip(_inputThis,_opt){var _toolTipId=_inputThis.attr("aria-describedby");if(_toolTipId){$("#"+_toolTipId).css("display","block");return}var _width=_inputThis.width()/2;var _height=_inputThis.height();var $inputParentThis=_inputThis.parent("div");var _inputParent=$inputParentThis.attr("class");if(_inputParent&&_inputParent.indexOf("col-")>=0){_height=$inputParentThis.height()}var _id="tooltip"+Math.floor(Math.random()*10000+1);var _message=_inputThis.attr("message")||"请填写有效数据";var _html='<div class="tooltip fade top in" role="tooltip" id="'+_id+'" style="width: '+_width+"; top: -"+_height+"px; left: "+_width+'px; display: block;">';_html+='<div class="tooltip-arrow" style="left: 50%;"></div>';_html+='<div class="tooltip-inner">'+_message+"</div></div>";_inputThis.attr("aria-describedby",_id);_inputThis.after(_html);if(_opt.tipTimeout>0){setTimeout(function(){removeTip(_inputThis)},_opt.tipTimeout*1000)}}function removeTip(_inputThis){var _toolTipId=_inputThis.attr("aria-describedby");if(_toolTipId){$("#"+_toolTipId).css("display","none")}}function bindFunction(_inputThis,_option){_inputThis.bind({focus:function(){removeTip(_inputThis);removeErrorStyle(_inputThis)},blur:function(){channle(_inputThis,_option)}})}function closeWarning(_iconThis){_iconThis.parent("div").remove()}function bindCloseWarning(t){t.bind({click:function(){closeWarning(t)}})}})(jQuery);
